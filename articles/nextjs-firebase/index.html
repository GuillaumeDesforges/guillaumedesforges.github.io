<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.0d5f8ea5d9045421c457.css" id="gatsby-global-css">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}main{min-height:calc(100vh - 96px)}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}p{text-align:justify}a{color:#699ea5;background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0;color:grey}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:georgia,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0 0 0 1.45rem;margin:0 1.45rem 1.45rem;border-left:3px solid #699ea5}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}</style><meta name="generator" content="Gatsby 2.27.4"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-184218145-1',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-184218145-1', 'auto', {});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><title data-react-helmet="true">Creating and deploying a NextJS app with Firebase | Guillaume Desforges&#x27; Blog</title><meta data-react-helmet="true" name="description" content="My personal website"/><meta data-react-helmet="true" property="og:title" content="Creating and deploying a NextJS app with Firebase"/><meta data-react-helmet="true" property="og:description" content="My personal website"/><meta data-react-helmet="true" property="og:type" content="website"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#699ea5"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png"/><link as="script" rel="preload" href="/webpack-runtime-4af22aa3d881e1b9345f.js"/><link as="script" rel="preload" href="/framework-44697bb84c432a102996.js"/><link as="script" rel="preload" href="/app-ad67cb265854e65ca917.js"/><link as="script" rel="preload" href="/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/commons-c8faa090aa439f9fb613.js"/><link as="script" rel="preload" href="/component---src-templates-article-template-js-0ed56a67829c8ab1881c.js"/><link as="fetch" rel="preload" href="/page-data/articles/nextjs-firebase/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="min-height:100vh;display:flex;flex-direction:column"><header style="background:#699ea5;margin-bottom:1.45rem"><div style="margin:0 auto;max-width:960px;padding:1.45rem 1.0875rem"><h1 style="margin:0"><a style="color:white;text-decoration:none" href="/"><div style="display:flex;justify-content:space-between;align-items:center"><div>Guillaume Desforges</div><img src="data:image/jpeg;base64,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" style="height:2em;margin:0;border-radius:1em" alt="Guillaume Desforges"/></div></a></h1></div></header><main style="margin:0 auto;max-width:960px;flex-grow:1;padding:1em"><div><div><h2>Creating and deploying a NextJS app with Firebase</h2><div style="font-style:italic"><div>10-12-2020<!-- --> - Tags: <!-- -->software engineering, web development, firebase</div><div>&gt; <!-- -->Serverless development is cool</div></div><div style="margin-top:3em;margin-bottom:7em" class="blog-post-content"><p>When doing Web development, even if the application that we want to build has only a few functionalities and requirements,
the fixed cost (understand "time") of creating an application, setting things up and deploying is never neglectable.</p>
<p>I want to be able to spawn Web application fast, from zero to a fully working deployed application available to the customer.</p>
<h2>Choose your <del>player</del> stack</h2>
<h3>NextJS</h3>
<p>In that regard, I think NextJS is a great tool.
In my opinion, NextJS facilitates the creation of a frontend.
From their <a href="https://nextjs.org/">front page</a>:</p>
<blockquote>
<p>Next.js gives you the best developer experience with all the features you need for production:
hybrid static &#x26; server rendering, TypeScript support, smart bundling, route pre-fetching, and more.
No config needed.</p>
</blockquote>
<p>Very cool!</p>
<p>It makes it easy to build a simple application, while giving enough freedom to make it more and more complex, as features are requested.</p>
<p>Also, it supports TypeScript, which is a hard-requirement for me.</p>
<h3>Firebase</h3>
<p>Firebase is part of the Google ecosystem.
It's a nice sugar on top of the Google Cloud Platform: while being able to tinker things on GCP, it manages most of (if not all) the tedious infrastructure work.</p>
<p>It also allows to have authentication, database (even real-time!) and storage without <strong>any code</strong>.
This is an awesome feature in order to create a product as fast as possible.</p>
<p>Firebase <a href="https://moqod.com/downsides-of-firebase-limitations-to-be-aware-of/">has limitations</a>, but it seems to be a good way to start a product and develop <em>fast</em>.</p>
<p>We will use Hosting (required for any Web app) and Functions (serverless) to deploy our app in production.</p>
<p>Also, at the time of writing, the free plan is pretty big, which is perfect for personal projects.
It sure caught my attention, but let's pray it will stay like this.</p>
<h2>Requirements</h2>
<p>You will need Node JS version 12.
I also promote the use of <a href="https://yarnpkg.com/">yarn</a> instead of npm.</p>
<h3>Start using Nix today (optional)</h3>
<p>Do you have issues managing all your development environments on your computer?</p>
<p>They conflict between each other because you install everything globally on your computer?</p>
<p>The development experience is inconsistent across the developers workstations?</p>
<p>Start using Nix for this project!</p>
<pre class="grvsc-container dark-visual-studio" data-language="bash" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">sh </span><span class="mtk11">&lt;(curl -L https://nixos.org/nix/install)</span><span class="mtk1"> --daemon </span><span class="mtk3"># install nix</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">nix-env (Nix) 2.3.6 </span><span class="mtk3"># check it has been installed</span></span></span></code></pre>
<p>create a <code>shell.nix</code> file in your project folder:</p>
<pre class="grvsc-container dark-visual-studio" data-language="nix" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">with import &lt;nixpkgs&gt; {};</span></span>
<span class="grvsc-line"><span class="grvsc-source">mkShell {</span></span>
<span class="grvsc-line"><span class="grvsc-source">  buildInputs = [</span></span>
<span class="grvsc-line"><span class="grvsc-source">    nodejs-12_x</span></span>
<span class="grvsc-line"><span class="grvsc-source">    yarn</span></span>
<span class="grvsc-line"><span class="grvsc-source">  ];</span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source">  shellHook = &#39;&#39;</span></span>
<span class="grvsc-line"><span class="grvsc-source">    export PATH=${toString ./.}/node_modules/.bin:$PATH</span></span>
<span class="grvsc-line"><span class="grvsc-source">  &#39;&#39;;</span></span>
<span class="grvsc-line"><span class="grvsc-source">}</span></span></code></pre>
<p>run</p>
<pre class="grvsc-container dark-visual-studio" data-language="bash" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">nix-shell</span></span></span></code></pre>
<p>wait and... poof, you get a shell with Node JS 12 and yarn!</p>
<p>In VS Code, you can use <a href="https://marketplace.visualstudio.com/items?itemName=arrterian.nix-env-selector">Nix Environment Selector</a>
to get the environment in the editor (e.g. for autocomplete, TypeScript language server, ...).</p>
<h2>Setup the Firebase project</h2>
<blockquote>
<p>If you have not done it yet, create a directory for your project, we'll consider it to be our working directory.</p>
</blockquote>
<p>Start by installing the Firebase CLI tools.</p>
<pre class="grvsc-container dark-visual-studio" data-language="bash" data-index="3"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">yarn add -D firebase-tools</span></span></span></code></pre>
<p>We now have to create our Firebase project.
It can be done on the Firebase website ("Console"), but also using the CLI.</p>
<p>In order to do such interactions, we need to login.</p>
<pre class="grvsc-container dark-visual-studio" data-language="bash" data-index="4"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">firebase login</span></span></span></code></pre>
<p>Follow the given steps.
After that, we can now run:</p>
<pre class="grvsc-container dark-visual-studio" data-language="bash" data-index="5"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">firebase init</span></span></span></code></pre>
<p>Select (arrows + space) "Hosting" and "Functions", then go further (enter).</p>
<blockquote>
<p>"Hosting" allows you to serve static files and use rewrite rules.
"Functions" allows to define Cloud Function written in JavaScript, for instance a HTTP server.</p>
</blockquote>
<p>After that, select "Create a new project".</p>
<p>Give it a project ID (it will be <code>nextjs-firebase</code> for me).
I tend to use the id as name as well (default behavior).</p>
<p>It then asks questions to setup "Functions".
I selected to use "TypeScript", not use ESLint (I can always set it up later), not install dependencies now (we will use yarn).</p>
<p>It then asks questions to setup "Hosting".
I selected all default settings: "public" folder, no URL rewrites, no builds &#x26; deploys with GitHub.</p>
<p>It normally has created:</p>
<ul>
<li><code>./.firebaserc</code>: sets the Firebase project ID to interact with when using the CLI</li>
<li><code>./firebase.json</code>: the configuration of your firebase project</li>
<li><code>./.gitignore</code></li>
<li><code>./public/</code>: used by our Hosting, contains the files served statically</li>
<li><code>./functions/</code>: a TypeScript project that will define our Cloud Functions</li>
</ul>
<h2>Your first deploy</h2>
<p>Let's deploy everything to check if it works!</p>
<p>Install dependencies for the <code>./functions/</code> folder with yarn:</p>
<pre class="grvsc-container dark-visual-studio" data-language="bash" data-index="6"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">yarn --cwd functions/ install</span></span></span></code></pre>
<p>Uncomment the code in <code>./functions/src/index.ts</code>.</p>
<pre class="grvsc-container dark-visual-studio" data-language="typescript" data-index="7"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">import</span><span class="mtk1"> </span><span class="mtk4">*</span><span class="mtk1"> </span><span class="mtk4">as</span><span class="mtk1"> functions </span><span class="mtk4">from</span><span class="mtk1"> </span><span class="mtk11">&quot;firebase-functions&quot;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// Start writing Firebase Functions</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// https://firebase.google.com/docs/functions/typescript</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">export</span><span class="mtk1"> </span><span class="mtk4">const</span><span class="mtk1"> helloWorld = functions.https.onRequest((request, response) </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  functions.logger.info(</span><span class="mtk11">&quot;Hello logs!&quot;</span><span class="mtk1">, { structuredData: </span><span class="mtk4">true</span><span class="mtk1"> });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  response.send(</span><span class="mtk11">&quot;Hello from Firebase!&quot;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">});</span></span></span></code></pre>
<p>The exported items are going to be Cloud Functions.
Here we define a Cloud Function <code>helloWorld</code>.</p>
<p>To make it accessible, we need to edit <code>firebase.json</code>:</p>
<pre class="grvsc-container dark-visual-studio" data-language="json" data-index="8"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">&quot;functions&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;predeploy&quot;</span><span class="mtk1">: [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk11">&quot;yarn --cwd functions/ build&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">&quot;hosting&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;public&quot;</span><span class="mtk1">: </span><span class="mtk11">&quot;public&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;ignore&quot;</span><span class="mtk1">: [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk11">&quot;firebase.json&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk11">&quot;**/.*&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk11">&quot;**/node_modules/**&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ],</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;rewrites&quot;</span><span class="mtk1">: [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk8">&quot;source&quot;</span><span class="mtk1">: </span><span class="mtk11">&quot;helloWorld&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk8">&quot;function&quot;</span><span class="mtk1">: </span><span class="mtk11">&quot;helloWorld&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>See that we have a <code>predeploy</code> attribute in <code>functions</code>, where we define our build command for instance.
I have edited it to use yarn instead of npm.</p>
<p>I added an attribute <code>rewrites</code> to <code>hosting</code>.
This allows to create rewrite rules for the web server.
It is a list of objects, that must have the attribute <code>source</code> (the route of the url requested), and either a <code>destinatiion</code> or <code>function</code>.
In our case, we want to redirect <code>/helloWorld</code> to our Cloud Function <code>helloWorld</code>, so we write the above rewrite rule.</p>
<p>Let's deploy it then!</p>
<pre class="grvsc-container dark-visual-studio" data-language="bash" data-index="9"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">firebase deploy</span></span></span></code></pre>
<p><strong>Woops!</strong>
Normally you should get an error: </p>
<pre class="grvsc-container dark-visual-studio" data-language="" data-index="10"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">Your project nextjs-firebase must be on the Blaze (pay-as-you-go) plan to complete this command.</span></span></code></pre>
<p>Follow the link and modify your billing (if you want to continue).</p>
<blockquote>
<p>Disclaimer: I cannot be held accountable for any billing you might have to pay. Continue at your own risks.</p>
</blockquote>
<p>... although the free plan is, in my opinion, quite large for small personnal projects.</p>
<p>You can even set a budget alert at 1$.</p>
<p>Let's deploy again:</p>
<pre class="grvsc-container dark-visual-studio" data-language="bash" data-index="11"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">firebase deploy</span></span></span></code></pre>
<p>Go check your website!</p>
<p>Your URL is given by the CLI (mine was <code>https://nextjs-firebase.web.app/</code>).</p>
<p>You should be greeted by a page, which code is from <code>./public/index.html</code> in your project.</p>
<p>Now go to the route <code>/helloWorld</code> (in my case <code>https://nextjs-firebase.web.app/helloWorld</code>)</p>
<p>You should get:</p>
<pre class="grvsc-container dark-visual-studio" data-language="" data-index="12"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">Hello from Firebase!</span></span></code></pre>
<p>Congrats!</p>
<h2>Setup NextJS</h2>
<p>We now want to setup a NextJS app.</p>
<p>From the working directory of our project, let's create it:</p>
<pre class="grvsc-container dark-visual-studio" data-language="bash" data-index="13"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">yarn create next-app --example with-typescript</span></span></span></code></pre>
<p>I used the default name, <code>my-app</code>.
A folder <code>my-app</code> has been created.</p>
<p>You can run the NextJS development server locally using:</p>
<pre class="grvsc-container dark-visual-studio" data-language="bash" data-index="14"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">yarn --cwd my-app/ dev</span></span></span></code></pre>
<p>That's it!
I won't explain how to do NextJS Web development, there are many ressources out there that do so.</p>
<p>Now, what we want to do is to run the NextJS server as a Cloud Function.</p>
<p>Because of the way Cloud Functions gets deployed, we will need to have our NextJS app folder inside of our Cloud Functions folder.
In my case, I decided to change the Cloud Functions folder to be the project directory.</p>
<p>In order to make this change, we need to set <code>functions.source</code> in <code>firebase.json</code>:</p>
<pre class="grvsc-container dark-visual-studio" data-language="json" data-index="15"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">&quot;functions&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;source&quot;</span><span class="mtk1">: </span><span class="mtk11">&quot;.&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;predeploy&quot;</span><span class="mtk1">: [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk11">&quot;yarn --cwd ./ build&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">&quot;hosting&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;public&quot;</span><span class="mtk1">: </span><span class="mtk11">&quot;public&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;ignore&quot;</span><span class="mtk1">: [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk11">&quot;firebase.json&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk11">&quot;**/.*&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk11">&quot;**/node_modules/**&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ],</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;rewrites&quot;</span><span class="mtk1">: [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk8">&quot;source&quot;</span><span class="mtk1">: </span><span class="mtk11">&quot;/helloWorld&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk8">&quot;function&quot;</span><span class="mtk1">: </span><span class="mtk11">&quot;helloWorld&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>Note that I had to also change the <code>predeploy</code> hooks.</p>
<p>I then move all the content from <code>./functions/</code> to <code>./</code>:</p>
<pre class="grvsc-container dark-visual-studio" data-language="bash" data-index="16"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3"># remove project-level package.json</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">rm package.json</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3"># move functions/src, tsconfig.json, package.json, </span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">mv functions/{scr,tsconfig.json,package.json} .</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3"># reinstall dependencies</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">yarn add -D firebase-tools</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">yarn install</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3"># remove old functions folder</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">rm -R functions</span></span></span></code></pre>
<p>You may have to update <code>./.gitignore</code>.</p>
<p>We can now change our Cloud Functions in <code>./src/index.ts</code>, and then rewrite all HTTP requests to this functions!</p>
<p><code>./src/index.ts</code></p>
<pre class="grvsc-container dark-visual-studio" data-language="typescript" data-index="17"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">import</span><span class="mtk1"> </span><span class="mtk4">*</span><span class="mtk1"> </span><span class="mtk4">as</span><span class="mtk1"> admin </span><span class="mtk4">from</span><span class="mtk1"> </span><span class="mtk11">&quot;firebase-admin&quot;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">import</span><span class="mtk1"> </span><span class="mtk4">*</span><span class="mtk1"> </span><span class="mtk4">as</span><span class="mtk1"> functions </span><span class="mtk4">from</span><span class="mtk1"> </span><span class="mtk11">&quot;firebase-functions&quot;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">import</span><span class="mtk1"> next </span><span class="mtk4">from</span><span class="mtk1"> </span><span class="mtk11">&quot;next&quot;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">admin.initializeApp();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> dev = process.env.NODE_ENV !== </span><span class="mtk11">&quot;production&quot;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> app = next({ dev, dir: </span><span class="mtk11">&quot;my-app&quot;</span><span class="mtk1"> });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> handle = app.getRequestHandler();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">export</span><span class="mtk1"> </span><span class="mtk4">const</span><span class="mtk1"> nextjs = functions.https.onRequest(</span><span class="mtk4">async</span><span class="mtk1"> (request, response) </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  console.log(</span><span class="mtk11">&quot;Received requested: &quot;</span><span class="mtk1"> + request.originalUrl);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk4">return</span><span class="mtk1"> app.prepare().then(() </span><span class="mtk4">=&gt;</span><span class="mtk1"> handle(request, response));</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">});</span></span></span></code></pre>
<p>The key thing here is this line:</p>
<pre class="grvsc-container dark-visual-studio" data-language="typescript" data-index="18"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk4">const</span><span class="mtk1"> app = next({ dev, dir: </span><span class="mtk11">&quot;my-app&quot;</span><span class="mtk1"> });</span></span></span></code></pre>
<p>We set the NextJS server folder to our NextJS app folder.</p>
<p>Since the Firebase CLI will pack and upload the source folder of our Cloud Functions (here our project folder), it needs to contain the NextJS folder,
which is why we did the moving operation above.</p>
<p>If we hadn't done it, the Cloud Function <code>nextjs</code> wouldn't have found the NextJS app folder (and its <code>.next</code> folder).</p>
<p>Now, we only need to setup our deployement configuration:</p>
<pre class="grvsc-container dark-visual-studio" data-language="json" data-index="19"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">&quot;functions&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;source&quot;</span><span class="mtk1">: </span><span class="mtk11">&quot;.&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;predeploy&quot;</span><span class="mtk1">: [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk11">&quot;yarn --cwd ./ build&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk11">&quot;yarn --cwd my-app/ build&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ],</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;ignore&quot;</span><span class="mtk1">: [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk11">&quot;**/node_modules/**&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">&quot;hosting&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;public&quot;</span><span class="mtk1">: </span><span class="mtk11">&quot;public&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;rewrites&quot;</span><span class="mtk1">: [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk8">&quot;source&quot;</span><span class="mtk1">: </span><span class="mtk11">&quot;**&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk8">&quot;function&quot;</span><span class="mtk1">: </span><span class="mtk11">&quot;nextjs&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    ]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>I have added another hook to build the NextJS application.
This will produce a <code>./my-app/.next/</code> folder with the compiled NextJS app.</p>
<p>I also edited the <code>hosting.rewrites</code> to redirect all requests to our NextJS server.</p>
<p>Before deployement, keep in mind that all files in <code>./public/</code> will overrule the rewrite rules and be served.
We need to remove them, while keeping the <code>./public</code> folder.</p>
<pre class="grvsc-container dark-visual-studio" data-language="bash" data-index="20"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">rm public/*</span></span></span></code></pre>
<p>Note that the NextJS server will run in the function, and requires some more dependencies.
In fact, the dependencies of your <code>my-app</code> project have to be given to the server whenever it might be neede for SSR (server-side rendering).</p>
<pre class="grvsc-container dark-visual-studio" data-language="" data-index="21"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">yarn add next react react-dom @types/react @types/react-dom webpack</span></span></code></pre>
<p>I also had to add the <code>esModuleInterop</code> to my <code>tsconfig.json</code>:</p>
<pre class="grvsc-container dark-visual-studio" data-language="json" data-index="22"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">&quot;compilerOptions&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;module&quot;</span><span class="mtk1">: </span><span class="mtk11">&quot;commonjs&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;noImplicitReturns&quot;</span><span class="mtk1">: </span><span class="mtk4">true</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;noUnusedLocals&quot;</span><span class="mtk1">: </span><span class="mtk4">true</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;outDir&quot;</span><span class="mtk1">: </span><span class="mtk11">&quot;lib&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;sourceMap&quot;</span><span class="mtk1">: </span><span class="mtk4">true</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;strict&quot;</span><span class="mtk1">: </span><span class="mtk4">true</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;target&quot;</span><span class="mtk1">: </span><span class="mtk11">&quot;es2017&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">&quot;esModuleInterop&quot;</span><span class="mtk1">: </span><span class="mtk4">true</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">&quot;compileOnSave&quot;</span><span class="mtk1">: </span><span class="mtk4">true</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">&quot;include&quot;</span><span class="mtk1">: [</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk11">&quot;src&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  ]</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<blockquote>
<p>You might encounter other build errors.
Fix them before continuing: you need to be able to run <code>yarn build</code> without issues.</p>
<p>For instance, I had to <a href="https://github.com/DefinitelyTyped/DefinitelyTyped/issues/49528">hack webpack temporarly</a>.</p>
</blockquote>
<p>Let's deploy!</p>
<pre class="grvsc-container dark-visual-studio" data-language="bash" data-index="23"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">firebase deploy</span></span></span></code></pre>
<p>It will ask if you would like to delete the <code>helloWorld</code> function.
You can (should) do so.</p>
<p>Check the given URL...</p>
<h2>Conclusion</h2>
<p>Does it work? Congrats!</p>
<p>If not, you should check out my repo: <a href="https://github.com/GuillaumeDesforges/nextjs-firebase">https://github.com/GuillaumeDesforges/nextjs-firebase</a></p>
<p>If you have any issue, don't hesitate to <a href="https://github.com/GuillaumeDesforges/nextjs-firebase/issues/new">create a new issue</a>.
I'll try my best to help you.</p>
<p>Now you have it, fast and scalable Web app development!</p>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .dark-visual-studio {
    background-color: #1E1E1E;
    color: #D4D4D4;
  }
  .dark-visual-studio .mtk1 { color: #D4D4D4; }
  .dark-visual-studio .mtk11 { color: #CE9178; }
  .dark-visual-studio .mtk3 { color: #6A9955; }
  .dark-visual-studio .mtk4 { color: #569CD6; }
  .dark-visual-studio .mtk8 { color: #9CDCFE; }
  .dark-visual-studio .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div></div></div></main><footer style="text-align:center;padding:1em;color:#AAA">Guillaume Desforges  <!-- -->2020</footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/articles/nextjs-firebase";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-ca8adf9770cfeec4c092.js"],"app":["/app-ad67cb265854e65ca917.js"],"component---src-pages-404-js":["/component---src-pages-404-js-0db82d6eeee6490b835e.js"],"component---src-pages-index-js":["/component---src-pages-index-js-037087f6bdef211ec824.js"],"component---src-templates-article-template-js":["/component---src-templates-article-template-js-0ed56a67829c8ab1881c.js"]};/*]]>*/</script><script src="/polyfill-ca8adf9770cfeec4c092.js" nomodule=""></script><script src="/component---src-templates-article-template-js-0ed56a67829c8ab1881c.js" async=""></script><script src="/commons-c8faa090aa439f9fb613.js" async=""></script><script src="/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/app-ad67cb265854e65ca917.js" async=""></script><script src="/framework-44697bb84c432a102996.js" async=""></script><script src="/webpack-runtime-4af22aa3d881e1b9345f.js" async=""></script></body></html>